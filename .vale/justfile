COLOR := "\\033[0;34m"
NO_COLOR := "\\033[0m"


# Show all available recipes
@_default:
    printf "\n{{ COLOR }}# Vale (path: \`.vale/\`)\n"
    printf "===================={{ NO_COLOR }}\n"
    just --list --unsorted


# Build a local version of `openverse-vale:local` for testing
build:
    docker build . -t openverse-vale:local


# The --glob setting excludes things that should not be linted, including
# build artefacts, dependencies, and automatically generated files like
# the changelogs (without excluding `changelogs/index.md`). Project proposals
# are also excluded for want of a good way to ignore existing proposals and only
# lint _new_ proposals. Project proposals aren't "living documents" in the way
# the rest of our documentation is, so it doesn't seem right to retroactively
# edit them for mere editorial purposes (rather than, for example, to correct
# some grave inacurracy).
VALE_FILES := (
    "documentation " +
    "--glob='!*{_build,_static,.venv,projects/proposals,changelogs/api,changelogs/frontend,changelogs/catalog,changelogs/ingestion_server}*'"
)


# Run Vale configured for Openverse in Docker.
# Using Docker avoids the need for contributors to install the Vale binary.
#Configuration defaults to what is used for CI.
run +configuration=VALE_FILES: build
    docker run --rm \
        -v $PWD/..:/src:rw,Z \
        --workdir=/src \
        openverse-vale:local \
        {{ configuration }}
